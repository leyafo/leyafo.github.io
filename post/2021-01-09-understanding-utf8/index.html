<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.71.0" />

  

  

  
  <title>Understanding UTF-8</title>
  

  <style>
body {
  color: #000000;
  line-height: 1.6em;
  padding: 1em;
  margin: auto;
  max-width: 72em;
  background: #fefefe;
  font-family: Fira Code,Monaco,Consolas,Ubuntu Mono,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,monospace,sans-serif;
}

nav {
    margin-bottom: 20px;
}
a:visited{
  color: grey;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255,255,255,.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255,255,255,1);
}






.comments{
    text-align: center;
    margin-top: 20px;
    padding: 5px 10px;
    font-size: .8rem;
    text-transform: uppercase;
    text-decoration: none;
    letter-spacing: .1em;
    z-index: 1;
}

.utterances{
  max-width: 100%;
}


.hr-middle-text{
  line-height: 1em;
  position: relative;
  outline: 0;
  border: 0;
  color: black;
  text-align: center;
  height: 1.5em;
  opacity: .5;
}
.hr-middle-text:before {
    content: '';
    
    
    
    background: linear-gradient(to right, transparent, black, transparent);
    position: absolute;
    left: 0;
    top: 50%;
    width: 100%;
    height: 1px;
}
.hr-middle-text:after{
    content: attr(data-content);
    position: relative;
    display: inline-block;
    color: black;

    padding: 0 .5em;
    line-height: 1.5em;
    
    
    background-color: #fcfcfa;
}

</style>

</head>


<body>
  <header>
<nav>
  [ <a class="nav-btn" href="http://www.leyafo.com/">Home</a> ] 
  [ <a class="nav-btn" href="http://www.leyafo.com/about.html">About</a> ] 
  [ <a class="nav-btn" href="http://www.leyafo.com/contact.html">Contact</a> ] 
</nav>
</header>
  
  <div>
    <article>
      <h1>Understanding UTF-8</h1>
<p>
  <small class="text-secondary">
  
  
  January 9, 2021
  </small>
  
</p>
<p>Many programmers are confused so long about the variation in <em>UTF-8</em>, <em>Unicode</em>, <em>ASCII</em>, <em>CP936</em>, <em>GB2312</em>, etc.  Why we were always being recommended use UTF-8 for our code in many situations? Character encoding is not a hard problem but it&rsquo;s unclear. To understand the character encoding problem clearly, we should separate the encoding method and character set first.</p>
<p>Just like Joel says: <em>Please do not write another line of code until you finish
reading <a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">this article</a></em>.I recommend you take 15 minutes to read my article, it&rsquo;s easy than Joel&rsquo;s.</p>
<p>In the ancient computer era(1970?), the world was simple and computer was born in US. The computer scientists(or a soft engineer?) treat the world just use English in computer. They designed all of information can be represent enough by 26 alphabets and other symbols; so that they invented ASCII as 127 code points which just include English alphabets, punctuations, and other control symbols.</p>
<p>As we know, computer store everything as Binary, which we call them as a bit 0 or 1. we can use 2<!-- raw HTML omitted -->7<!-- raw HTML omitted -->= 128 bits to store all ASCII code points. Today&rsquo;s computer use 2<!-- raw HTML omitted -->8<!-- raw HTML omitted -->=256 bits to represent a byte. The reason that use 8 bits for a byte can be powered by 2 and to be aligned easy.  That&rsquo;s why a byte is not 2<!-- raw HTML omitted -->7<!-- raw HTML omitted --> or 2<!-- raw HTML omitted -->9<!-- raw HTML omitted -->.  If we define a byte as
2<!-- raw HTML omitted -->16<!-- raw HTML omitted --> or 2<!-- raw HTML omitted -->32<!-- raw HTML omitted -->, it waste too space (to store 127 ASCII code ^_^).  Therefore, until today, a byte store ASCII code always start with 0, it just an empty bit.</p>
<p>People then find the computer is hard to represent the other language characters soon. In reality, we can use our hands draw any language words on papers, but computer can&rsquo;t. We should convert our language to digit first, like ASCII table.  In 1991, Unicode invented, it defined all language characters to digits into a table. For ASCII compatible, the first 127 code points is equal ASCII. As of March 2020, there was a total of 143,859 characters. we can use 32bits Integer to represent all characters. But it doesn&rsquo;t mean every character need 32bits Integer.</p>
<p>For example, if we have a character &lsquo;a&rsquo; which represent 0x61 the same as ASCII. we can store it just in one byte. If we have a character &lsquo;æ–‡&rsquo; that represent 0xe69687 in Unicode. we should store it in three bytes(e6 96 87).</p>
<p>For reduce the storage, our bytes length should be variable, and given information to tell this word that has how many bytes.</p>
<p>So, Let&rsquo;s check how UTF-8 implementing.</p>
<p>UTF-8 use one byte to represent ASCII(0~127).<br>
If a code point large than 127, things became different. It separate two parts, the
one part is start with 11 which represent the number of bytes. The other is start with 10, we called it as follow byte.</p>
<p>Here is UTF-8 encode, x means storage data:</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#b452cd">0000</span> <span style="color:#b452cd">0000</span>-<span style="color:#b452cd">0000</span> <span style="color:#b452cd">007F</span> | <span style="color:#b452cd">0</span>xxxxxxx                               <span style="color:#228b22">//ASCII
</span><span style="color:#228b22"></span><span style="color:#b452cd">0000</span> <span style="color:#b452cd">00</span><span style="color:#b452cd">80</span>-<span style="color:#b452cd">0000</span> <span style="color:#b452cd">07FF</span> | <span style="color:#b452cd">110</span>xxxxx <span style="color:#b452cd">10</span>xxxxxx						 <span style="color:#228b22">//Two bytes
</span><span style="color:#228b22"></span><span style="color:#b452cd">0000</span> <span style="color:#b452cd">0800</span>-<span style="color:#b452cd">0000</span> FFFF | <span style="color:#b452cd">1110</span>xxxx <span style="color:#b452cd">10</span>xxxxxx <span style="color:#b452cd">10</span>xxxxxx			 <span style="color:#228b22">//Three bytes
</span><span style="color:#228b22"></span><span style="color:#b452cd">0001</span> <span style="color:#b452cd">0000</span>-<span style="color:#b452cd">0010</span> FFFF | <span style="color:#b452cd">11110</span>xxx <span style="color:#b452cd">10</span>xxxxxx <span style="color:#b452cd">10</span>xxxxxx <span style="color:#b452cd">10</span>xxxxxx    <span style="color:#228b22">//Four bytes
</span></code></pre></div><p>If a word start with 110, it means two bytes word. 1110 means three bytes, 11110
means four bytes. UTF-8 support max 4 bytes encoding; excluding the sign bit, it has 2<!-- raw HTML omitted -->21<!-- raw HTML omitted --> = 2,097,152 code points.</p>
<p>There is a question here, why the follow byte start with 10?</p>
<p>In network transfer, we send information with one by one byte. if a byte start with 0, we know this is a ASCII byte. if start with 10, means is a follow byte. If we lost a byte, we can drop the other byte fast, which can prevent to occur the half-word problem. In operate system, if we want to remove a word, we can find the byte start without 10, which is easy and simple.</p>
<p>As you see above, UTF-8 use one-byte oriented to encode every Unicode character. It has two benefits, the one is we don&rsquo;t need to clue the big-endian or little-endian. The other is some old C-library can compatible in UTF-8. <code>strcmp</code> can work, because we can compare every word by byte; but <code>strlen</code> is not, because many Unicode words didn&rsquo;t just stored in one byte.</p>
<p>That&rsquo;s why UTF-8 are spreading the most popular, it has these benefits:</p>
<ol>
<li>fully comparable ASCII</li>
<li>variant length encode</li>
<li>error-tolerance, encode and decode easy</li>
<li>byte-oriented, no byte order problems</li>
</ol>
<p>You can treat every charset encode method as two parts, the one is a character table, the other is store the code point. Use this method, the term cp936, gb2312, and other encode methods will not confuse you.</p>

<div class="comments">
  <hr class="hr-middle-text" data-content="COMMENTS">
  <script src="https://utteranc.es/client.js" repo="leyafo/leyafo.github.io" issue-term="title" label="Commnets" theme="github-light" crossorigin="anonymous" async >
  </script>
</div>
    </article>
  </div>
</body>
</html>
